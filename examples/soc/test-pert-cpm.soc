// Test de Funciones PERT/CPM - Phase 4L
// Prueba todas las funciones de gestión de proyectos implementadas en la VM

print("=== PRUEBAS DE PERT/CPM ===")
print("")

// ============================================================
// Test 1: CPM Básico (Forward Pass)
// ============================================================
print("--- Test 1: Forward Pass (ES y EF) ---")

let project_edges = [
    Start -> A,
    Start -> B,
    A -> C,
    B -> C,
    C -> End
]

let project_nodes = {
    Start: {duration: 0},
    A: {duration: 3},
    B: {duration: 5},
    C: {duration: 2},
    End: {duration: 0}
}

let project = network(project_edges, project_nodes)
let project_fp = forward_pass(project)

print("Proyecto después de Forward Pass:")
print("  Nodo Start:", project_fp.nodes.Start)
print("  Nodo A:", project_fp.nodes.A)
print("  Nodo B:", project_fp.nodes.B)
print("  Nodo C:", project_fp.nodes.C)
print("  Nodo End:", project_fp.nodes.End)
print("")

// ============================================================
// Test 2: Backward Pass (LS y LF)
// ============================================================
print("--- Test 2: Backward Pass (LS y LF) ---")

let project_bp = backward_pass(project)

print("Proyecto después de Backward Pass:")
print("  Nodo Start:", project_bp.nodes.Start)
print("  Nodo A:", project_bp.nodes.A)
print("  Nodo B:", project_bp.nodes.B)
print("  Nodo C:", project_bp.nodes.C)
print("  Nodo End:", project_bp.nodes.End)
print("")

// ============================================================
// Test 3: Calculate Slack
// ============================================================
print("--- Test 3: Calculate Slack ---")

let project_slack = calculate_slack(project)

print("Proyecto con Slack:")
print("  Nodo Start:", project_slack.nodes.Start)
print("  Nodo A:", project_slack.nodes.A)
print("  Nodo B:", project_slack.nodes.B)
print("  Nodo C:", project_slack.nodes.C)
print("  Nodo End:", project_slack.nodes.End)
print("")

// ============================================================
// Test 4: Critical Path
// ============================================================
print("--- Test 4: Critical Path ---")

let cp = critical_path(project)
print("Camino crítico:", cp)

let all_cp = all_critical_paths(project)
print("Todos los caminos críticos:", all_cp)

let duration = project_duration(project)
print("Duración del proyecto:", duration)
print("")

// ============================================================
// Test 5: PERT Probabilístico - Expected Time
// ============================================================
print("--- Test 5: Expected Time y Task Variance ---")

let op = 2.0   // Optimistic time
let mo = 4.0   // Most likely time
let pe = 6.0   // Pessimistic time

let te = expected_time(op, mo, pe)
let variance = task_variance(op, mo, pe)

print("Tiempos PERT:")
print("  Optimista (op):", op)
print("  Más probable (mo):", mo)
print("  Pesimista (pe):", pe)
print("  Esperado (te):", te)
print("  Varianza:", variance)
print("")

// ============================================================
// Test 6: Proyecto PERT Probabilístico
// ============================================================
print("--- Test 6: Proyecto PERT Probabilístico ---")

let pert_edges = [
    Start -> A,
    Start -> B,
    A -> C,
    B -> C,
    C -> End
]

let pert_nodes = {
    Start: {op: 0, mo: 0, pe: 0},
    A: {op: 2, mo: 3, pe: 4},
    B: {op: 4, mo: 5, pe: 6},
    C: {op: 1, mo: 2, pe: 3},
    End: {op: 0, mo: 0, pe: 0}
}

let pert_project = network(pert_edges, pert_nodes)

let pert_var = project_variance(pert_project)
let pert_std = project_std_dev(pert_project)

print("Varianza del proyecto:", pert_var)
print("Desviación estándar del proyecto:", pert_std)
print("")

// ============================================================
// Test 7: Probabilidades de Completitud
// ============================================================
print("--- Test 7: Probabilidades de Completitud ---")

// Probabilidad de completar en 10 días
let target_time = 10.0
let prob = completion_probability(pert_project, target_time)
print("Probabilidad de completar en", target_time, "días:", prob)

// Tiempo necesario para 90% de probabilidad
let desired_prob = 0.9
let time_needed = time_for_probability(pert_project, desired_prob)
print("Tiempo necesario para", desired_prob * 100, "% de probabilidad:", time_needed)
print("")

// ============================================================
// Test 8: PERT Analysis Completo
// ============================================================
print("--- Test 8: PERT Analysis Completo ---")

let analysis = pert_analysis(pert_project)

print("Análisis PERT completo:")
print("  Camino crítico:", analysis.critical_path)
print("  Duración:", analysis.duration)
print("  Varianza:", analysis.variance)
print("  Desviación estándar:", analysis.std_dev)
print("")

// ============================================================
// Test 9: Proyecto Complejo con Múltiples Caminos
// ============================================================
print("--- Test 9: Proyecto Complejo ---")

let complex_edges = [
    Start -> A,
    Start -> B,
    A -> C,
    A -> D,
    B -> D,
    C -> E,
    D -> E,
    E -> End
]

let complex_nodes = {
    Start: {duration: 0},
    A: {duration: 4},
    B: {duration: 3},
    C: {duration: 2},
    D: {duration: 5},
    E: {duration: 3},
    End: {duration: 0}
}

let complex_project = network(complex_edges, complex_nodes)
let complex_result = calculate_slack(complex_project)

print("Proyecto complejo con slack:")
print("  Nodo A - Slack:", complex_result.nodes.A.slack)
print("  Nodo B - Slack:", complex_result.nodes.B.slack)
print("  Nodo C - Slack:", complex_result.nodes.C.slack)
print("  Nodo D - Slack:", complex_result.nodes.D.slack)
print("  Nodo E - Slack:", complex_result.nodes.E.slack)

let complex_cp = critical_path(complex_project)
print("Camino crítico del proyecto complejo:", complex_cp)

let complex_duration = project_duration(complex_project)
print("Duración del proyecto complejo:", complex_duration, "días")
print("")

print("=== TODAS LAS PRUEBAS COMPLETADAS ===")
