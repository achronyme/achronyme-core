// Performance test - no UI, just signals and effects
println("Performance test starting...")

let phase = signal(0.0)
let wave_data = signal([])

// Effect that generates 500 points
effect(() => do {
    let p = phase.value
    let points = map((i) => do {
        let x = i / 25.0
        let y = sin(x + p)
        [x, y]
    }, range(0, 500))
    wave_data.set(points)
})

// Animator
let animator = async () => do {
    let i = 0
    while(i < 300) {  // ~5 seconds at 60fps
        await sleep(16)
        phase.set(phase.peek() + 0.1)
        i = i + 1
        if (i % 60 == 0) {
            println("Frame " + str(i) + ", phase=" + str(phase.peek()))
        }
    }
    println("Done!")
}

spawn(animator)
await sleep(6000)
println("Test complete")
