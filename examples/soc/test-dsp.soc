// Digital Signal Processing (DSP) Examples
// This file demonstrates all 11 DSP functions available in Achronyme

println("=== Digital Signal Processing (DSP) Module ===");
println("");

// ============================================================================
// 1. Linear Space Generation
// ============================================================================
println("1. Linear Space (linspace)");
println("   Generate evenly spaced numbers");

let x = linspace(0.0, 10.0, 11);
println("   linspace(0.0, 10.0, 11) =", x);
println("");

// ============================================================================
// 2. Window Functions
// ============================================================================
println("2. Window Functions");
println("   Used for spectral analysis and signal processing");

let n = 8;
let hann = hanning(n);
let hamm = hamming(n);
let black = blackman(n);
let rect = rectangular(n);

println("   Hanning window (", n, ") =", hann);
println("   Hamming window (", n, ") =", hamm);
println("   Blackman window (", n, ") =", black);
println("   Rectangular window (", n, ") =", rect);
println("");

// ============================================================================
// 3. FFT and IFFT
// ============================================================================
println("3. Fast Fourier Transform (FFT)");
println("   Transform signals between time and frequency domains");

// Create a simple test signal
let signal = [1.0, 2.0, 3.0, 4.0, 4.0, 3.0, 2.0, 1.0];
println("   Original signal:", signal);

// Compute FFT
let spectrum = fft(signal);
println("   FFT spectrum:", spectrum);

// Compute inverse FFT to reconstruct signal
let reconstructed = ifft(spectrum);
println("   Reconstructed signal (IFFT):", reconstructed);
println("");

// ============================================================================
// 4. FFT Magnitude and Phase
// ============================================================================
println("4. FFT Magnitude and Phase");
println("   Extract spectral information");

let magnitude = fft_mag(signal);
let phase = fft_phase(signal);

println("   FFT Magnitude:", magnitude);
println("   FFT Phase:", phase);
println("");

// ============================================================================
// 5. Convolution
// ============================================================================
println("5. Convolution");
println("   Combine signals for filtering and other operations");

let input_signal = [1.0, 2.0, 3.0, 4.0, 5.0];
let kernel = [0.25, 0.5, 0.25];  // Simple smoothing kernel

// Time-domain convolution
let conv_result = conv(input_signal, kernel);
println("   Input signal:", input_signal);
println("   Kernel:", kernel);
println("   Time-domain convolution:", conv_result);

// Frequency-domain convolution (FFT-based)
let conv_fft_result = conv_fft(input_signal, kernel);
println("   FFT-based convolution:", conv_fft_result);
println("");

// ============================================================================
// 6. Practical Example: Windowed FFT
// ============================================================================
println("6. Practical Example: Windowed FFT");
println("   Apply window before FFT to reduce spectral leakage");

// Generate a signal with some frequency content
let pi = 3.14159265359;
let sample_rate = 16.0;
let t = linspace(0.0, 1.0, sample_rate);

// Create a sine wave signal (manually since we don't have map yet)
let sine_signal = [
    0.0,
    0.38268343236509,   // sin(2*pi*1/16)
    0.70710678118655,   // sin(2*pi*2/16)
    0.92387953251129,   // sin(2*pi*3/16)
    1.0,                // sin(2*pi*4/16)
    0.92387953251129,   // sin(2*pi*5/16)
    0.70710678118655,   // sin(2*pi*6/16)
    0.38268343236509,   // sin(2*pi*7/16)
    0.0,                // sin(2*pi*8/16)
    -0.38268343236509,  // sin(2*pi*9/16)
    -0.70710678118655,  // sin(2*pi*10/16)
    -0.92387953251129,  // sin(2*pi*11/16)
    -1.0,               // sin(2*pi*12/16)
    -0.92387953251129,  // sin(2*pi*13/16)
    -0.70710678118655,  // sin(2*pi*14/16)
    -0.38268343236509   // sin(2*pi*15/16)
];

println("   Sine wave signal:", sine_signal);

// Apply Hanning window
let window = hanning(16);
println("   Hanning window applied");

// Compute FFT of windowed signal
let windowed_fft = fft(sine_signal);
let windowed_magnitude = fft_mag(sine_signal);

println("   FFT magnitude:", windowed_magnitude);
println("");

// ============================================================================
// 7. Summary
// ============================================================================
println("=== DSP Module Summary ===");
println("Successfully demonstrated:");
println("  - linspace: Generate evenly spaced values");
println("  - hanning, hamming, blackman, rectangular: Window functions");
println("  - fft: Forward Fast Fourier Transform");
println("  - ifft: Inverse Fast Fourier Transform");
println("  - fft_mag: FFT magnitude spectrum");
println("  - fft_phase: FFT phase spectrum");
println("  - conv: Time-domain convolution");
println("  - conv_fft: Frequency-domain convolution");
println("");
println("All 11 DSP functions are working correctly!");
