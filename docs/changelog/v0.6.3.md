---
version: "0.6.3"
date: 2025-11-16
title: "Loop Control, Nullable Types & LSP Server"
description: "For-in loops, break/continue, optional parameters, nullable types, type exports, LSP server, and documentation overhaul"
breaking: false
status: "Released"
highlights:
  - "For-in Loops for Vectors and Tensors"
  - "Break and Continue Statements"
  - "Optional and Nullable Parameters"
  - "Type Export in Modules"
  - "Initial LSP Server Implementation"
  - "Documentation Site Migration"
---

## New Features

### For-In Loops
- Iterate over Vectors and Tensors with `for(item in collection) { ... }`
- Works with both homogeneous Tensors and heterogeneous Vectors
- Returns the last expression value from the loop body
- Supports nested loops

```javascript
let numbers = [1, 2, 3, 4, 5]
mut sum = 0
for(x in numbers) {
    sum += x
}
sum  // 15

// With Tensors
let matrix = [[1, 2], [3, 4]]
for(row in matrix) {
    for(val in row) {
        print(val)
    }
}
```

### Break and Continue Statements
- `break` exits the innermost loop immediately
- `break value` exits and returns a value from the loop
- `continue` skips to the next iteration
- Works in both `while` and `for-in` loops

```javascript
// Break with value
let found = while(true) {
    let result = search();
    if(result > 100) { break result }
}

// Continue to skip iterations
mut sum = 0
for(x in [1, 2, 3, 4, 5]) {
    if(x % 2 == 0) { continue }  // Skip evens
    sum += x
}
sum  // 9 (1 + 3 + 5)
```

### Optional and Nullable Parameters
- Optional parameters with `?` syntax: `(param?: Type)`
- Default to `null` when not provided
- Nullable types: `Type | null` or `?Type`
- Combine with pattern matching for safe handling

```javascript
// Optional parameter
let greet = (name: String, title?: String) =>
    match title {
        null => name
        t => '${t} ${name}'
    }

greet("Alice")         // "Alice"
greet("Smith", "Dr.")  // "Dr. Smith"

// Nullable type annotation
let maybeNumber: Number | null = null
```

### Type Export in Modules
- Export type aliases with `export { TypeName }`
- Import types from other modules
- Full module system support for custom types

```javascript
// In types.soc
type Result = Number | Error
type User = {name: String, age: Number, email?: String}
export { Result, User }

// In main.soc
import { Result, User } from "types"
let user: User = {name: "Alice", age: 30}
```

### Pattern Matching Improvements
- Fixed guard clause parsing with required parentheses
- Improved pattern compilation for nested structures
- Better error messages for pattern mismatches

```javascript
// Guard clauses now require parentheses
match value {
    n if (n > 0) => "positive"    // Correct
    n if (n < 0) => "negative"    // Correct
    _ => "zero"
}
```

### Language Server Protocol (LSP) Server
- Initial implementation of Achronyme LSP server for IDE integration
- **Diagnostics**: Real-time parse error reporting with line/column information
- **Hover Information**: Documentation for 80+ built-in functions and 20+ keywords
- **Go to Definition**: Navigate to variable and function definitions
- **Find References**: Locate all usages of symbols in the document
- **Document Symbols**: Outline view with variables, mutables, and type definitions
- **Document Synchronization**: Full text sync with incremental updates

### IDE Support
- VS Code extension compatibility via stdio transport
- Tower-LSP framework for robust async operation
- Markdown-formatted hover documentation
- Real-time error diagnostics as you type

### Documentation Overhaul
- Migrated documentation to Astro Content Collections format
- Restructured `docs/language/` into logical subdirectories:
  - `getting-started/` - Introduction, installation, syntax basics
  - `core-language/` - Data types, operators, variables, functions, control flow
  - `data-structures/` - Records, arrays/tensors, indexing, strings
  - `functional-programming/` - Higher-order functions, do-blocks, recursion
  - `mathematical-computing/` - Math functions, linear algebra, complex numbers, numerical analysis, statistics
  - `specialized-modules/` - DSP, graph theory, optimization
  - `advanced-topics/` - Pattern matching, error handling, destructuring, generators, modules, etc.
- Individual changelog files per version with YAML frontmatter
- Improved navigation and searchability
- Documentation site live at docs.achrony.me

### Documentation Corrections
- Clarified that `{ }` creates record literals, NOT code blocks
- Documented requirement for `do { }` for statement blocks
- Updated guard clause syntax to require parentheses: `n if (n < 0) =>`
- Corrected language philosophy: "expression-oriented with statements" (not purely expression-based)
- Added documentation for `null` type and optional values
- Updated keyword list to include all 20+ reserved words
- Fixed installation instructions to prioritize binary downloads over building from source

## Improvements

### Developer Experience
- LSP provides foundation for rich IDE features
- Better error messages with precise source locations
- Consistent documentation format for static site generation
- Updated README with correct documentation links

### Code Quality
- Comprehensive built-in function documentation in LSP hover provider
- Structured keyword information for IDE support
- Modular LSP architecture with separate handlers for each feature

## Technical Details

### LSP Architecture
```
achronyme-lsp/
├── main.rs           # Entry point (stdio transport)
├── server.rs         # Backend with document management
└── handlers/
    ├── diagnostics.rs   # Parse error reporting
    ├── hover.rs         # Contextual documentation
    ├── definition.rs    # Go to definition
    ├── references.rs    # Find all references
    └── symbols.rs       # Document outline
```

### Dependencies Added
- `tower-lsp = "0.20"` - LSP framework
- `tokio = "1"` - Async runtime
- `dashmap = "5.5"` - Concurrent document storage

## Known Limitations

- LSP completion provider is configured but not yet implemented
- Definition/references use text search (AST spans not fully utilized)
- No semantic analysis beyond parse errors
- Single-file analysis only (no cross-file imports)

## Migration Notes

### For IDE Users
1. Build LSP binary: `cargo build --release -p achronyme-lsp`
2. Configure VS Code extension to use the new LSP server path
3. Enjoy real-time diagnostics, hover documentation, and navigation

### For Documentation Contributors
- All docs now require YAML frontmatter with title, description, section, and order
- Use `do { }` for statement blocks, not bare `{ }`
- Guard clauses require parentheses: `if (condition)`
- Reference new directory structure when linking between docs

## What's Next (v0.6.4)

- Complete LSP completion provider with context-aware suggestions
- Code formatter (`achronyme fmt`)
- IEEE 754 compliance (Infinity, NaN)
- Basic linting (`achronyme lint`)
- Improved type inference display in hover
